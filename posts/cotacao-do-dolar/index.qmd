---
title: "An√°lise do D√≥lar com Python e API do Banco Central"
author: "Samuel Andrey"
date: "2025-11-19"
categories: [python, data-science, api, finance, plotly]
image: "image_dolar.jpg"
---

Veja a varia√ß√£o do pre√ßo do d√≥lar no per√≠odo de 11/2024 üíµüíπ

---

### Importa√ß√£o das Bibliotecas

Para iniciar nossa an√°lise, precisamos importar as ferramentas necess√°rias. Utilizaremos o `calendar` e `datetime` para manipula√ß√£o de datas, `requests` para acessar a API do Banco Central, `pandas` para tratar os dados em formato tabular e `plotly.express` para a visualiza√ß√£o gr√°fica.

```python
import calendar
import requests
import pandas as pd
import plotly.express as px
from datetime import datetime
```

---

### Defini√ß√£o do Per√≠odo de An√°lise

Aqui definimos a fun√ß√£o principal que recebe a string com m√™s e ano (ex: "112024"). O c√≥digo calcula automaticamente o primeiro e o √∫ltimo dia do m√™s selecionado para preparar a consulta √† API.

```python
def gerar_grafico_dolar(data_str):
    first_date = datetime.strptime(data_str, "%m%Y")
    last_day = calendar.monthrange(first_date.year, first_date.month)[1]
    last_date = first_date.replace(day=last_day)
```

---

### Consulta √† API do Banco Central (PTAX)

Com as datas definidas, formatamos a URL de acordo com a documenta√ß√£o da API Olinda do Banco Central. A requisi√ß√£o busca a cota√ß√£o de venda do d√≥lar para o intervalo estipulado.

```python
    start_api = first_date.strftime("'%m-%d-%Y'")
    end_api = last_date.strftime("'%m-%d-%Y'")

    url = f"https://olinda.bcb.gov.br/olinda/servico/PTAX/versao/v1/odata/CotacaoDolarPeriodo(dataInicial={start_api},dataFinalCotacao={end_api})?%24format=json"

    res = requests.get(url)
    dados_json = res.json()

    if 'value' not in dados_json or len(dados_json['value']) == 0:
        print("Nenhum dado encontrado.")
        return
```

---

### Tratamento de Dados e Preenchimento de Lacunas

Esta √© uma etapa crucial. A API n√£o retorna dados de fins de semana ou feriados. Para manter o gr√°fico cont√≠nuo, criamos um √≠ndice com **todos** os dias do m√™s e utilizamos o m√©todo `ffill()` (*forward fill*). Isso garante que, em dias sem cota√ß√£o (como domingo), seja repetido o valor do √∫ltimo dia √∫til (sexta-feira).

```python
    df = pd.DataFrame(dados_json['value'])
    df['dataHoraCotacao'] = pd.to_datetime(df['dataHoraCotacao']).dt.normalize()
    df['cotacaoVenda'] = pd.to_numeric(df['cotacaoVenda'])
    df = df.set_index('dataHoraCotacao')

    idx_completo = pd.date_range(start=first_date, end=last_date)
    df_completo = df.reindex(idx_completo)
    df_completo['cotacaoVenda'] = df_completo['cotacaoVenda'].ffill()

    df_final = df_completo.reset_index()
    df_final.rename(columns={'index': 'Data', 'cotacaoVenda': 'Valor D√≥lar (R$)'}, inplace=True)
```

---

### Gera√ß√£o do Gr√°fico

Por fim, utilizamos a biblioteca **Plotly** para criar um gr√°fico de linha interativo. Adicionamos marcadores para facilitar a visualiza√ß√£o dos pontos di√°rios de cota√ß√£o.

```python
    fig = px.line(
        df_final, 
        x='Data', 
        y='Valor D√≥lar (R$)', 
        title=f'Cota√ß√£o do D√≥lar - Per√≠odo: {data_str}',
        markers=True
    )
    
    fig.show()
```

---

### C√≥digo Completo e Resultado

Abaixo, a execu√ß√£o completa da rotina para o m√™s de Novembro de 2024.

```{python}
import calendar
import requests
import pandas as pd
import plotly.express as px
from datetime import datetime

def gerar_grafico_dolar(data_str):
    first_date = datetime.strptime(data_str, "%m%Y")
    last_day = calendar.monthrange(first_date.year, first_date.month)[1]
    last_date = first_date.replace(day=last_day)

    start_api = first_date.strftime("'%m-%d-%Y'")
    end_api = last_date.strftime("'%m-%d-%Y'")

    url = f"https://olinda.bcb.gov.br/olinda/servico/PTAX/versao/v1/odata/CotacaoDolarPeriodo(dataInicial={start_api},dataFinalCotacao={end_api})?%24format=json"

    res = requests.get(url)
    dados_json = res.json()

    if 'value' not in dados_json or len(dados_json['value']) == 0:
        print("Nenhum dado encontrado.")
        return

    df = pd.DataFrame(dados_json['value'])
    df['dataHoraCotacao'] = pd.to_datetime(df['dataHoraCotacao']).dt.normalize()
    df['cotacaoVenda'] = pd.to_numeric(df['cotacaoVenda'])
    df = df.set_index('dataHoraCotacao')

    idx_completo = pd.date_range(start=first_date, end=last_date)
    df_completo = df.reindex(idx_completo)
    df_completo['cotacaoVenda'] = df_completo['cotacaoVenda'].ffill()

    df_final = df_completo.reset_index()
    df_final.rename(columns={'index': 'Data', 'cotacaoVenda': 'Valor D√≥lar (R$)'}, inplace=True)

    fig = px.line(
        df_final, 
        x='Data', 
        y='Valor D√≥lar (R$)', 
        title=f'Cota√ß√£o do D√≥lar - Per√≠odo: {data_str}',
        markers=True
    )
    
    fig.show()

gerar_grafico_dolar("112024")
```