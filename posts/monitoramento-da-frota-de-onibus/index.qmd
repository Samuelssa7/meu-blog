---
title: "Monitoramento da Frota de 칎nibus"
author: "Samuel Andrey"
date: "2025-11-19"
categories: [python, folium, geodata, api, maps]
image: "image_bus.jpg"
---

Veja as paradas e localiza칞칚o em tempo real de um 칪nibus utilizando a API da SPTrans. 游뚧游늸

---

### 1. Configura칞칚o e Autentica칞칚o

Primeiro, importamos as bibliotecas necess치rias. O `folium` ser치 usado para gerar o mapa, `requests` para consumir a API e `dotenv` para carregar nossa credencial de seguran칞a (Token) de um arquivo oculto, garantindo que a chave n칚o fique exposta no c칩digo.

Em seguida, iniciamos uma sess칚o e nos autenticamos na API da SPTrans.

```python
import os
import requests
from folium import Map, Marker, Icon
from dotenv import load_dotenv

load_dotenv(".env")

s = requests.Session()
res = s.post(
    f"http://api.olhovivo.sptrans.com.br/v2.1/Login/Autenticar?token=(http://api.olhovivo.sptrans.com.br/v2.1/Login/Autenticar?token=){os.getenv('SPTRANS_TOKEN')}"
)
```

---

### 2. Obtendo a Posi칞칚o em Tempo Real

Aqui fazemos a requisi칞칚o para descobrir onde os 칪nibus da linha **2304** est칚o neste exato momento. O c칩digo extrai a latitude (`py`) e longitude (`px`) do primeiro ve칤culo encontrado na lista de resposta.

```python
pos = s.get(
    "http://api.olhovivo.sptrans.com.br/v2.1//Posicao/Linha?codigoLinha=2304(http://api.olhovivo.sptrans.com.br/v2.1//Posicao/Linha?codigoLinha=2304)"
)
posicao_atual = pos.json()
py_bus = posicao_atual["vs"][0]["py"]
px_bus = posicao_atual["vs"][0]["px"]
```

---

### 3. Mapeando as Paradas

Al칠m da posi칞칚o do 칪nibus, buscamos a lista de todas as paradas dessa linha espec칤fica para desenhar o trajeto no mapa.

```python
res = s.get(
    "http://api.olhovivo.sptrans.com.br/v2.1/Parada/BuscarParadasPorLinha?codigoLinha=2304(http://api.olhovivo.sptrans.com.br/v2.1/Parada/BuscarParadasPorLinha?codigoLinha=2304)"
)
paradas = res.json()
```

---

### 4. Gerando o Mapa Interativo

Por fim, criamos o mapa centralizado na posi칞칚o do 칪nibus. Usamos um la칞o de repeti칞칚o (`for`) para adicionar marcadores azuis (padr칚o) em cada parada. Para o 칪nibus, adicionamos um marcador especial verde com 칤cone de 칪nibus, destacando sua posi칞칚o atual em rela칞칚o aos pontos de parada.

```python
m = Map(location=[py_bus, px_bus], zoom_start=14)
for i in paradas:
    Marker(location=[i["py"], i["px"]], popup="PARADA " + i["np"]).add_to(m)
Marker(location=[py_bus, px_bus], popup="칎NIBUS", icon=Icon(color='green', icon='bus', prefix='fa')).add_to(m)

m
```

---

### C칩digo Completo e Resultado

Veja abaixo o c칩digo completo em execu칞칚o e o mapa interativo gerado:

```{python}
import os
import requests
from folium import Map, Marker, Icon
from dotenv import load_dotenv

load_dotenv(".env")

s = requests.Session()
res = s.post(
    f"http://api.olhovivo.sptrans.com.br/v2.1/Login/Autenticar?token={os.getenv('SPTRANS_TOKEN')}"
)

pos = s.get(
    "http://api.olhovivo.sptrans.com.br/v2.1//Posicao/Linha?codigoLinha=2304"
)
posicao_atual = pos.json()
py_bus = posicao_atual["vs"][0]["py"]
px_bus = posicao_atual["vs"][0]["px"]

res = s.get(
    "http://api.olhovivo.sptrans.com.br/v2.1/Parada/BuscarParadasPorLinha?codigoLinha=2304"
)
paradas = res.json()

m = Map(location=[py_bus, px_bus], zoom_start=14)
for i in paradas:
    Marker(location=[i["py"], i["px"]], popup="PARADA " + i["np"]).add_to(m)
Marker(location=[py_bus, px_bus], popup="칎NIBUS", icon=Icon(color='green', icon='bus', prefix='fa')).add_to(m)

m
```