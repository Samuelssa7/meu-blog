{
  "hash": "10f5b759463b20621cd78ef17d492cca",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"Monitoramento da Frota de ﾃ馬ibus\"\nauthor: \"Samuel Andrey\"\ndate: \"2025-11-19\"\ncategories: [python, folium, geodata, api, maps]\nimage: \"image_bus.jpg\"\n---\n\nVeja as paradas e localizaﾃｧﾃ｣o em tempo real de um ﾃｴnibus utilizando a API da SPTrans. 泅交沒構n\n---\n\n### 1. Configuraﾃｧﾃ｣o e Autenticaﾃｧﾃ｣o\n\nPrimeiro, importamos as bibliotecas necessﾃ｡rias. O `folium` serﾃ｡ usado para gerar o mapa, `requests` para consumir a API e `dotenv` para carregar nossa credencial de seguranﾃｧa (Token) de um arquivo oculto, garantindo que a chave nﾃ｣o fique exposta no cﾃｳdigo.\n\nEm seguida, iniciamos uma sessﾃ｣o e nos autenticamos na API da SPTrans.\n\n```python\nimport os\nimport requests\nfrom folium import Map, Marker, Icon\nfrom dotenv import load_dotenv\n\nload_dotenv(\".env\")\n\ns = requests.Session()\nres = s.post(\n    f\"http://api.olhovivo.sptrans.com.br/v2.1/Login/Autenticar?token=(http://api.olhovivo.sptrans.com.br/v2.1/Login/Autenticar?token=){os.getenv('SPTRANS_TOKEN')}\"\n)\n```\n\n---\n\n### 2. Obtendo a Posiﾃｧﾃ｣o em Tempo Real\n\nAqui fazemos a requisiﾃｧﾃ｣o para descobrir onde os ﾃｴnibus da linha **2304** estﾃ｣o neste exato momento. O cﾃｳdigo extrai a latitude (`py`) e longitude (`px`) do primeiro veﾃｭculo encontrado na lista de resposta.\n\n```python\npos = s.get(\n    \"http://api.olhovivo.sptrans.com.br/v2.1//Posicao/Linha?codigoLinha=2304(http://api.olhovivo.sptrans.com.br/v2.1//Posicao/Linha?codigoLinha=2304)\"\n)\nposicao_atual = pos.json()\npy_bus = posicao_atual[\"vs\"][0][\"py\"]\npx_bus = posicao_atual[\"vs\"][0][\"px\"]\n```\n\n---\n\n### 3. Mapeando as Paradas\n\nAlﾃｩm da posiﾃｧﾃ｣o do ﾃｴnibus, buscamos a lista de todas as paradas dessa linha especﾃｭfica para desenhar o trajeto no mapa.\n\n```python\nres = s.get(\n    \"http://api.olhovivo.sptrans.com.br/v2.1/Parada/BuscarParadasPorLinha?codigoLinha=2304(http://api.olhovivo.sptrans.com.br/v2.1/Parada/BuscarParadasPorLinha?codigoLinha=2304)\"\n)\nparadas = res.json()\n```\n\n---\n\n### 4. Gerando o Mapa Interativo\n\nPor fim, criamos o mapa centralizado na posiﾃｧﾃ｣o do ﾃｴnibus. Usamos um laﾃｧo de repetiﾃｧﾃ｣o (`for`) para adicionar marcadores azuis (padrﾃ｣o) em cada parada. Para o ﾃｴnibus, adicionamos um marcador especial verde com ﾃｭcone de ﾃｴnibus, destacando sua posiﾃｧﾃ｣o atual em relaﾃｧﾃ｣o aos pontos de parada.\n\n```python\nm = Map(location=[py_bus, px_bus], zoom_start=14)\nfor i in paradas:\n    Marker(location=[i[\"py\"], i[\"px\"]], popup=\"PARADA \" + i[\"np\"]).add_to(m)\nMarker(location=[py_bus, px_bus], popup=\"ﾃ年IBUS\", icon=Icon(color='green', icon='bus', prefix='fa')).add_to(m)\n\nm\n```\n\n---\n\n### Cﾃｳdigo Completo e Resultado\n\nVeja abaixo o cﾃｳdigo completo em execuﾃｧﾃ｣o e o mapa interativo gerado:\n\n::: {#57489488 .cell execution_count=1}\n``` {.python .cell-code}\nimport os\nimport requests\nfrom folium import Map, Marker, Icon\nfrom dotenv import load_dotenv\n\nload_dotenv(\".env\")\n\ns = requests.Session()\nres = s.post(\n    f\"http://api.olhovivo.sptrans.com.br/v2.1/Login/Autenticar?token={os.getenv('SPTRANS_TOKEN')}\"\n)\n\npos = s.get(\n    \"http://api.olhovivo.sptrans.com.br/v2.1//Posicao/Linha?codigoLinha=2304\"\n)\nposicao_atual = pos.json()\npy_bus = posicao_atual[\"vs\"][0][\"py\"]\npx_bus = posicao_atual[\"vs\"][0][\"px\"]\n\nres = s.get(\n    \"http://api.olhovivo.sptrans.com.br/v2.1/Parada/BuscarParadasPorLinha?codigoLinha=2304\"\n)\nparadas = res.json()\n\nm = Map(location=[py_bus, px_bus], zoom_start=14)\nfor i in paradas:\n    Marker(location=[i[\"py\"], i[\"px\"]], popup=\"PARADA \" + i[\"np\"]).add_to(m)\nMarker(location=[py_bus, px_bus], popup=\"ﾃ年IBUS\", icon=Icon(color='green', icon='bus', prefix='fa')).add_to(m)\n\nm\n```\n\n::: {.cell-output .cell-output-display execution_count=1}\n```{=html}\n<div style=\"width:100%;\"><div style=\"position:relative;width:100%;height:0;padding-bottom:60%;\"><span style=\"color:#565656\">Make this Notebook Trusted to load map: File -> Trust Notebook</span><iframe srcdoc=\"&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n    \n    &lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=UTF-8&quot; /&gt;\n    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.js&quot;&gt;&lt;/script&gt;\n    &lt;script src=&quot;https://code.jquery.com/jquery-3.7.1.min.js&quot;&gt;&lt;/script&gt;\n    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js&quot;&gt;&lt;/script&gt;\n    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.js&quot;&gt;&lt;/script&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.css&quot;/&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css&quot;/&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap-glyphicons.css&quot;/&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.0/css/all.min.css&quot;/&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.css&quot;/&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/python-visualization/folium/folium/templates/leaflet.awesome.rotate.min.css&quot;/&gt;\n    \n            &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width,\n                initial-scale=1.0, maximum-scale=1.0, user-scalable=no&quot; /&gt;\n            &lt;style&gt;\n                #map_d488caf5a90ff3b86fc5c7637d6ba25b {\n                    position: relative;\n                    width: 100.0%;\n                    height: 100.0%;\n                    left: 0.0%;\n                    top: 0.0%;\n                }\n                .leaflet-container { font-size: 1rem; }\n            &lt;/style&gt;\n\n            &lt;style&gt;html, body {\n                width: 100%;\n                height: 100%;\n                margin: 0;\n                padding: 0;\n            }\n            &lt;/style&gt;\n\n            &lt;style&gt;#map {\n                position:absolute;\n                top:0;\n                bottom:0;\n                right:0;\n                left:0;\n                }\n            &lt;/style&gt;\n\n            &lt;script&gt;\n                L_NO_TOUCH = false;\n                L_DISABLE_3D = false;\n            &lt;/script&gt;\n\n        \n&lt;/head&gt;\n&lt;body&gt;\n    \n    \n            &lt;div class=&quot;folium-map&quot; id=&quot;map_d488caf5a90ff3b86fc5c7637d6ba25b&quot; &gt;&lt;/div&gt;\n        \n&lt;/body&gt;\n&lt;script&gt;\n    \n    \n            var map_d488caf5a90ff3b86fc5c7637d6ba25b = L.map(\n                &quot;map_d488caf5a90ff3b86fc5c7637d6ba25b&quot;,\n                {\n                    center: [-23.515027500000002, -46.698626],\n                    crs: L.CRS.EPSG3857,\n                    ...{\n  &quot;zoom&quot;: 14,\n  &quot;zoomControl&quot;: true,\n  &quot;preferCanvas&quot;: false,\n}\n\n                }\n            );\n\n            \n\n        \n    \n            var tile_layer_5045c374704fa1cd9c4e705292a1dfb9 = L.tileLayer(\n                &quot;https://tile.openstreetmap.org/{z}/{x}/{y}.png&quot;,\n                {\n  &quot;minZoom&quot;: 0,\n  &quot;maxZoom&quot;: 19,\n  &quot;maxNativeZoom&quot;: 19,\n  &quot;noWrap&quot;: false,\n  &quot;attribution&quot;: &quot;\\u0026copy; \\u003ca href=\\&quot;https://www.openstreetmap.org/copyright\\&quot;\\u003eOpenStreetMap\\u003c/a\\u003e contributors&quot;,\n  &quot;subdomains&quot;: &quot;abc&quot;,\n  &quot;detectRetina&quot;: false,\n  &quot;tms&quot;: false,\n  &quot;opacity&quot;: 1,\n}\n\n            );\n        \n    \n            tile_layer_5045c374704fa1cd9c4e705292a1dfb9.addTo(map_d488caf5a90ff3b86fc5c7637d6ba25b);\n        \n    \n            var marker_dbd1736668fc6359b080f1a73d41ed1d = L.marker(\n                [-23.525799, -46.679251],\n                {\n}\n            ).addTo(map_d488caf5a90ff3b86fc5c7637d6ba25b);\n        \n    \n        var popup_cc40582d3062b09e1c146964502f90f6 = L.popup({\n  &quot;maxWidth&quot;: &quot;100%&quot;,\n});\n\n        \n            \n                var html_d4a7072aa7ec5f1ef3f1aa2aabe44265 = $(`&lt;div id=&quot;html_d4a7072aa7ec5f1ef3f1aa2aabe44265&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;PARADA PARADA PALMEIRAS B/C&lt;/div&gt;`)[0];\n                popup_cc40582d3062b09e1c146964502f90f6.setContent(html_d4a7072aa7ec5f1ef3f1aa2aabe44265);\n            \n        \n\n        marker_dbd1736668fc6359b080f1a73d41ed1d.bindPopup(popup_cc40582d3062b09e1c146964502f90f6)\n        ;\n\n        \n    \n    \n            var marker_83fe86849155f60f4f577e96992d9cc1 = L.marker(\n                [-23.511052, -46.705493],\n                {\n}\n            ).addTo(map_d488caf5a90ff3b86fc5c7637d6ba25b);\n        \n    \n        var popup_62f78f4c69f64cbd3446034011bfac12 = L.popup({\n  &quot;maxWidth&quot;: &quot;100%&quot;,\n});\n\n        \n            \n                var html_05227a442d4d50bcc00468a6e2fbca5f = $(`&lt;div id=&quot;html_05227a442d4d50bcc00468a6e2fbca5f&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;PARADA MARGINAL B/C&lt;/div&gt;`)[0];\n                popup_62f78f4c69f64cbd3446034011bfac12.setContent(html_05227a442d4d50bcc00468a6e2fbca5f);\n            \n        \n\n        marker_83fe86849155f60f4f577e96992d9cc1.bindPopup(popup_62f78f4c69f64cbd3446034011bfac12)\n        ;\n\n        \n    \n    \n            var marker_938ecf1309f0488e9a21d39f2a1c9509 = L.marker(\n                [-23.514036, -46.702259],\n                {\n}\n            ).addTo(map_d488caf5a90ff3b86fc5c7637d6ba25b);\n        \n    \n        var popup_6e725a092f7b3d9b502bd3ea38306b6d = L.popup({\n  &quot;maxWidth&quot;: &quot;100%&quot;,\n});\n\n        \n            \n                var html_d30b99d39b6db69ee6eba2964764b0de = $(`&lt;div id=&quot;html_d30b99d39b6db69ee6eba2964764b0de&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;PARADA JOSE MARIA B/C&lt;/div&gt;`)[0];\n                popup_6e725a092f7b3d9b502bd3ea38306b6d.setContent(html_d30b99d39b6db69ee6eba2964764b0de);\n            \n        \n\n        marker_938ecf1309f0488e9a21d39f2a1c9509.bindPopup(popup_6e725a092f7b3d9b502bd3ea38306b6d)\n        ;\n\n        \n    \n    \n            var marker_b0dc639c512ffef8053b69dcc1d6a9dc = L.marker(\n                [-23.516592, -46.698575],\n                {\n}\n            ).addTo(map_d488caf5a90ff3b86fc5c7637d6ba25b);\n        \n    \n        var popup_157eacd0a6f8665b49c316902e2a7e03 = L.popup({\n  &quot;maxWidth&quot;: &quot;100%&quot;,\n});\n\n        \n            \n                var html_7691d735e34b6daf10aea49c430cb955 = $(`&lt;div id=&quot;html_7691d735e34b6daf10aea49c430cb955&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;PARADA ZANELLA B/C&lt;/div&gt;`)[0];\n                popup_157eacd0a6f8665b49c316902e2a7e03.setContent(html_7691d735e34b6daf10aea49c430cb955);\n            \n        \n\n        marker_b0dc639c512ffef8053b69dcc1d6a9dc.bindPopup(popup_157eacd0a6f8665b49c316902e2a7e03)\n        ;\n\n        \n    \n    \n            var marker_8c3643e2aa9bdb360425064df874662e = L.marker(\n                [-23.52494, -46.698995],\n                {\n}\n            ).addTo(map_d488caf5a90ff3b86fc5c7637d6ba25b);\n        \n    \n        var popup_3a6ba6088a6296810dc674ac06472517 = L.popup({\n  &quot;maxWidth&quot;: &quot;100%&quot;,\n});\n\n        \n            \n                var html_e0f3496abf7ba2eaec554f5bfb650da8 = $(`&lt;div id=&quot;html_e0f3496abf7ba2eaec554f5bfb650da8&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;PARADA SCIPIAO B/C&lt;/div&gt;`)[0];\n                popup_3a6ba6088a6296810dc674ac06472517.setContent(html_e0f3496abf7ba2eaec554f5bfb650da8);\n            \n        \n\n        marker_8c3643e2aa9bdb360425064df874662e.bindPopup(popup_3a6ba6088a6296810dc674ac06472517)\n        ;\n\n        \n    \n    \n            var marker_aae4f3664f2b39f99c58bf8e33ea97d6 = L.marker(\n                [-23.524994, -46.695297],\n                {\n}\n            ).addTo(map_d488caf5a90ff3b86fc5c7637d6ba25b);\n        \n    \n        var popup_2617055a0c74f832c09fd07b0e44c0cc = L.popup({\n  &quot;maxWidth&quot;: &quot;100%&quot;,\n});\n\n        \n            \n                var html_67239bd4bfda24c656e2f3eb5b3459f8 = $(`&lt;div id=&quot;html_67239bd4bfda24c656e2f3eb5b3459f8&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;PARADA VESPASIANO B/C&lt;/div&gt;`)[0];\n                popup_2617055a0c74f832c09fd07b0e44c0cc.setContent(html_67239bd4bfda24c656e2f3eb5b3459f8);\n            \n        \n\n        marker_aae4f3664f2b39f99c58bf8e33ea97d6.bindPopup(popup_2617055a0c74f832c09fd07b0e44c0cc)\n        ;\n\n        \n    \n    \n            var marker_3bf6e284a8dae006bc5bc8f0ca59716a = L.marker(\n                [-23.525029, -46.690074],\n                {\n}\n            ).addTo(map_d488caf5a90ff3b86fc5c7637d6ba25b);\n        \n    \n        var popup_ffe60b7de94ee78783bdb713d01fe13f = L.popup({\n  &quot;maxWidth&quot;: &quot;100%&quot;,\n});\n\n        \n            \n                var html_88af1ebeb04b63fbaa88f0dcdc7ca781 = $(`&lt;div id=&quot;html_88af1ebeb04b63fbaa88f0dcdc7ca781&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;PARADA CORNELIA&lt;/div&gt;`)[0];\n                popup_ffe60b7de94ee78783bdb713d01fe13f.setContent(html_88af1ebeb04b63fbaa88f0dcdc7ca781);\n            \n        \n\n        marker_3bf6e284a8dae006bc5bc8f0ca59716a.bindPopup(popup_ffe60b7de94ee78783bdb713d01fe13f)\n        ;\n\n        \n    \n    \n            var marker_231a20c8573e35706a690373ebb9f71b = L.marker(\n                [-23.52517, -46.683408],\n                {\n}\n            ).addTo(map_d488caf5a90ff3b86fc5c7637d6ba25b);\n        \n    \n        var popup_7cb10013b1df215b1cb7e6ff1988f577 = L.popup({\n  &quot;maxWidth&quot;: &quot;100%&quot;,\n});\n\n        \n            \n                var html_de5cd453028bf07c4fb641df9d422fbd = $(`&lt;div id=&quot;html_de5cd453028bf07c4fb641df9d422fbd&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;PARADA SESC POMPEIA B/C&lt;/div&gt;`)[0];\n                popup_7cb10013b1df215b1cb7e6ff1988f577.setContent(html_de5cd453028bf07c4fb641df9d422fbd);\n            \n        \n\n        marker_231a20c8573e35706a690373ebb9f71b.bindPopup(popup_7cb10013b1df215b1cb7e6ff1988f577)\n        ;\n\n        \n    \n    \n            var marker_76404767c53b2261daabe254e94da1ec = L.marker(\n                [-23.500896, -46.706633],\n                {\n}\n            ).addTo(map_d488caf5a90ff3b86fc5c7637d6ba25b);\n        \n    \n        var popup_d0d7ecf725303e7b4b8619157723e2fb = L.popup({\n  &quot;maxWidth&quot;: &quot;100%&quot;,\n});\n\n        \n            \n                var html_de93f13c2e1b831ff460bab3f5c53e42 = $(`&lt;div id=&quot;html_de93f13c2e1b831ff460bab3f5c53e42&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;PARADA PAULA FERREIRA B/C&lt;/div&gt;`)[0];\n                popup_d0d7ecf725303e7b4b8619157723e2fb.setContent(html_de93f13c2e1b831ff460bab3f5c53e42);\n            \n        \n\n        marker_76404767c53b2261daabe254e94da1ec.bindPopup(popup_d0d7ecf725303e7b4b8619157723e2fb)\n        ;\n\n        \n    \n    \n            var marker_862b9e2043077869b2c0556b651a6c74 = L.marker(\n                [-23.50616, -46.706061],\n                {\n}\n            ).addTo(map_d488caf5a90ff3b86fc5c7637d6ba25b);\n        \n    \n        var popup_1905d2bc736aa3824f6893081c291478 = L.popup({\n  &quot;maxWidth&quot;: &quot;100%&quot;,\n});\n\n        \n            \n                var html_aa01531771b963d9f17bb20cca201b99 = $(`&lt;div id=&quot;html_aa01531771b963d9f17bb20cca201b99&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;PARADA PIQUERI B/C&lt;/div&gt;`)[0];\n                popup_1905d2bc736aa3824f6893081c291478.setContent(html_aa01531771b963d9f17bb20cca201b99);\n            \n        \n\n        marker_862b9e2043077869b2c0556b651a6c74.bindPopup(popup_1905d2bc736aa3824f6893081c291478)\n        ;\n\n        \n    \n    \n            var marker_cec10aade0d2290ce0f2ad4468b4abab = L.marker(\n                [-23.515027500000002, -46.698626],\n                {\n}\n            ).addTo(map_d488caf5a90ff3b86fc5c7637d6ba25b);\n        \n    \n            var icon_305c35fa52d9360edf49610b29b683af = L.AwesomeMarkers.icon(\n                {\n  &quot;markerColor&quot;: &quot;green&quot;,\n  &quot;iconColor&quot;: &quot;white&quot;,\n  &quot;icon&quot;: &quot;bus&quot;,\n  &quot;prefix&quot;: &quot;fa&quot;,\n  &quot;extraClasses&quot;: &quot;fa-rotate-0&quot;,\n}\n            );\n        \n    \n        var popup_1b4079e5326da4e01f624f7fa50ec2e2 = L.popup({\n  &quot;maxWidth&quot;: &quot;100%&quot;,\n});\n\n        \n            \n                var html_1b00164944962ba80d13c8ed6d97c1b5 = $(`&lt;div id=&quot;html_1b00164944962ba80d13c8ed6d97c1b5&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;ﾃ年IBUS&lt;/div&gt;`)[0];\n                popup_1b4079e5326da4e01f624f7fa50ec2e2.setContent(html_1b00164944962ba80d13c8ed6d97c1b5);\n            \n        \n\n        marker_cec10aade0d2290ce0f2ad4468b4abab.bindPopup(popup_1b4079e5326da4e01f624f7fa50ec2e2)\n        ;\n\n        \n    \n    \n                marker_cec10aade0d2290ce0f2ad4468b4abab.setIcon(icon_305c35fa52d9360edf49610b29b683af);\n            \n&lt;/script&gt;\n&lt;/html&gt;\" style=\"position:absolute;width:100%;height:100%;left:0;top:0;border:none !important;\" allowfullscreen webkitallowfullscreen mozallowfullscreen></iframe></div></div>\n```\n:::\n:::\n\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdn.jsdelivr.net/npm/requirejs@2.3.6/require.min.js\" integrity=\"sha384-c9c+LnTbwQ3aujuU7ULEPVvgLs+Fn6fJUvIGTsuu1ZcCf11fiEubah0ttpca4ntM sha384-6V1/AdqZRWk1KAlWbKBlGhN7VG4iE/yAZcO6NZPMF8od0vukrvr0tg4qY6NSrItx\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js\" integrity=\"sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2\" crossorigin=\"anonymous\" data-relocate-top=\"true\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}